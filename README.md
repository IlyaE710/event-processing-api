# Event Processing API

## Описание задачи

API принимает события (до 10,000) для группы аккаунтов (1,000 аккаунтов) и помещает их в очередь на обработку. Каждое событие привязано к определенному аккаунту, и важно, чтобы события одного аккаунта обрабатывались строго в порядке их поступления. Обработка одного события занимает 1 секунду (эмулируется с помощью `sleep`).

## Архитектура

### Компоненты системы

1. **Web API**: Принимает запросы на добавление событий, назначает каждому событию очередь в зависимости от аккаунта и записывает данные в Redis.
2. **Очередь Redis**: Используется для хранения событий для каждого аккаунта в виде отдельных очередей.
3. **Процесс-менеджер (ForkedProcessManager)**: Параллельно обрабатывает очереди для всех аккаунтов, чтобы ускорить выполнение.
4. **Обработчик событий (UserEventWorker)**: Работает с каждой очередью и обрабатывает события для конкретного аккаунта в строгом порядке поступления.

## Стек технологий

- **PHP8.3**: Язык программирования.
- **Yii2**: PHP фреймворк.
- **Redis**: Хранилище для очередей с обработкой по приоритету.
- **PCNTL**: PHP модуль для управления параллельными процессами.

## Установка и настройка

1. **Клонирование репозитория**:

    ```bash
    git clone https://github.com/ilyae710/event-processing-api.git
    cd event-processing-api
    ```

2. **Установка зависимостей**:

    ```bash
    docker-compose exec php-cli composer install
    ```
3. **Копирование конфигурации**:

    ```bash
    cp .env.example .env
    ```

4. **Запуск docker-compose**:
    ```bash
    docker-compose up -d --build
    ```

### Создание и выполнение событий

1. **Создание событий**:

   Для создания событий выполните команду:

    ```bash
    docker-compose exec php-cli php yii event
    ```

2. **Запуск обработки очереди**:

   Для выполнения обработки очереди выполните:

    ```bash
    docker-compose exec php-cli php yii queue/run
    ```